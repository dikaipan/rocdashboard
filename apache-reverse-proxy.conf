# Apache Reverse Proxy Configuration for ROC Dashboard
# Place this in your Apache sites-available directory
# Example: /etc/apache2/sites-available/rocdashboard.conf

<VirtualHost *:80>
    ServerName your-domain.com
    DocumentRoot /path/to/rocdash/frontend/dist

    # Enable proxy modules (run: a2enmod proxy proxy_http)
    ProxyPreserveHost On
    ProxyRequests Off

    # Proxy API requests to Flask backend
    ProxyPass /api http://127.0.0.1:5000/api
    ProxyPassReverse /api http://127.0.0.1:5000/api

    # Serve frontend static files
    <Directory /path/to/rocdash/frontend/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # SPA fallback
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>

    # CORS headers
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"

    # Compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    </IfModule>

    ErrorLog ${APACHE_LOG_DIR}/rocdashboard_error.log
    CustomLog ${APACHE_LOG_DIR}/rocdashboard_access.log combined
</VirtualHost>
