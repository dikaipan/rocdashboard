import{r as u,U as P,C as L,b as N,ad as Z,j as e,a8 as I,s as z,ak as R,al as _,am as $,t as K,w as x,X as U,Q as W,D as B,x as Y,Y as G,v as S,an as C,ao as X,ap as H}from"./vendor-react-DhTDDHjY.js";import{u as Q,a as V}from"./useEngineerData-CH_O1yHW.js";import{c as k,T as v,b as F,a as O,u as q,L as J}from"./index-DmJzWoJv.js";import{P as ee}from"./PageLayout-I56-JVwe.js";import"./vendor-maps-C_U1R0uQ.js";function ae(n,r){const s=u.useMemo(()=>n.length?n.map(i=>({name:i.name||"Unknown",experience:parseInt(i.experience)||0,training:i.training_completion==="completed"?100:50,skills:i.skill_level==="Advanced"?90:i.skill_level==="Intermediate"?70:50,machines:r.filter(a=>a.engineer_name===i.name).length,performance:Math.min(100,(parseInt(i.experience)||0)*10+(i.training_completion==="completed"?20:0))})).sort((i,a)=>a.performance-i.performance).slice(0,5):[],[n,r]),c=u.useMemo(()=>{if(!r.length)return[];const i={};return r.forEach(a=>{const t=a.machine_type||"Unknown";i[t]||(i[t]={type:t,total:0,onWarranty:0,avgAge:0,ages:[]}),i[t].total++,(a.machine_status==="On Warranty"||a.machine_status==="In Warranty")&&i[t].onWarranty++;const g=new Date().getFullYear()-(parseInt(a.year)||new Date().getFullYear());i[t].ages.push(g)}),Object.values(i).map(a=>({type:a.type,total:a.total,warrantyRate:(a.onWarranty/a.total*100).toFixed(1),avgAge:(a.ages.reduce((t,g)=>t+g,0)/a.ages.length).toFixed(1),score:a.onWarranty/a.total*50+(10-a.ages.reduce((t,g)=>t+g,0)/a.ages.length)*5})).sort((a,t)=>t.score-a.score).slice(0,6)},[r]),m=u.useMemo(()=>{if(!n.length||!r.length)return[];const i={};return n.forEach(a=>{const t=a.region||"Unknown";i[t]||(i[t]={region:t,engineers:0,machines:0,avgExp:0,expSum:0}),i[t].engineers++,i[t].expSum+=parseInt(a.experience)||0}),r.forEach(a=>{const t=a.region||"Unknown";i[t]||(i[t]={region:t,engineers:0,machines:0,avgExp:0,expSum:0}),i[t].machines++}),Object.values(i).map(a=>({region:a.region,engineers:a.engineers,machines:a.machines,avgExp:a.engineers>0?(a.expSum/a.engineers).toFixed(1):0,ratio:a.engineers>0?(a.machines/a.engineers).toFixed(1):0,efficiency:a.engineers>0?Math.min(100,a.machines/a.engineers*20):0})).sort((a,t)=>t.efficiency-a.efficiency).slice(0,5)},[n,r]),o=u.useMemo(()=>!n.length||!r.length?[]:n.map(a=>{const t=a.zone||a.area_group||"Unknown",g=r.filter(p=>p.engineer_name===a.name);let f=0,y=0,b=0;return g.forEach(p=>{const j=p.zone||p.area_group||"Unknown";j===t?f++:Math.abs((j.match(/\d+/)||[0])[0]-(t.match(/\d+/)||[0])[0])<=1?y++:b++}),{engineer:a.name,zone:t,sameZone:f,nearZone:y,farZone:b,total:g.length,distanceScore:f*1+y*2+b*4}}).filter(a=>a.total>0).sort((a,t)=>t.distanceScore-a.distanceScore).slice(0,6),[n,r]),d=u.useMemo(()=>{if(!r.length)return[];const i={};return r.forEach(a=>{var g;const t=a.zone||a.area_group||"Unknown";i[t]||(i[t]={zone:t,machines:0,engineersAssigned:new Set,needsAttention:0}),i[t].machines++,a.engineer_name&&i[t].engineersAssigned.add(a.engineer_name),(a.machine_status==="Out Of Warranty"||(g=a.maintenance_status)!=null&&g.includes("Pending"))&&i[t].needsAttention++}),Object.values(i).map(a=>({zone:a.zone,machines:a.machines,engineers:a.engineersAssigned.size,ratio:a.engineersAssigned.size>0?(a.machines/a.engineersAssigned.size).toFixed(1):a.machines,needsAttention:a.needsAttention,priority:a.needsAttention/a.machines*100})).sort((a,t)=>t.priority-a.priority).slice(0,6)},[r]);return{topEngineersData:s,machinePerformanceData:c,regionalComparisonData:m,distanceAnalysisData:o,zoneOptimizationData:d}}function ne(n){var d,i,a,t,g,f,y,b,p,j,w,A,D,E,M,T;const{topEngineersData:r,machinePerformanceData:s,regionalComparisonData:c,distanceAnalysisData:m,zoneOptimizationData:o}=n;return[{id:"engineer-performance",title:"Top Engineer Performance",icon:P,color:"blue",summary:`${r.length} top engineers analyzed`,metric:((d=r[0])==null?void 0:d.performance)||0,metricLabel:"Best Score",chartType:"radar",data:r,description:"Analisis performa engineer berdasarkan pengalaman, training completion, skill level, dan jumlah mesin yang ditangani.",analysis:[`Engineer terbaik: ${((i=r[0])==null?void 0:i.name)||"N/A"} dengan score ${((a=r[0])==null?void 0:a.performance)||0}`,`Rata-rata pengalaman: ${r.length>0?(r.reduce((l,h)=>l+h.experience,0)/r.length).toFixed(1):0} tahun`,`${r.filter(l=>l.training===100).length} dari ${r.length} engineer sudah complete training`],recommendations:["Assign high-priority machines ke engineer dengan performance tertinggi","Berikan additional training untuk engineer dengan score < 70","Balance workload berdasarkan jumlah mesin yang ditangani"]},{id:"machine-comparison",title:"Machine Type Comparison",icon:L,color:"purple",summary:`${s.length} machine types compared`,metric:((t=s[0])==null?void 0:t.warrantyRate)||0,metricLabel:"Best Warranty %",chartType:"bar",data:s,description:"Perbandingan tipe mesin berdasarkan warranty coverage, umur rata-rata, dan total unit. Skor dihitung dari kombinasi warranty rate dan kondisi mesin.",analysis:[`Tipe mesin terbaik: ${((g=s[0])==null?void 0:g.type)||"N/A"} (warranty ${(f=s[0])==null?void 0:f.warrantyRate}%)`,`Umur rata-rata mesin: ${s.length>0?(s.reduce((l,h)=>l+parseFloat(h.avgAge),0)/s.length).toFixed(1):0} tahun`,`${s.filter(l=>parseFloat(l.warrantyRate)>70).length} tipe mesin dengan warranty > 70%`],recommendations:["Fokus pembelian pada tipe mesin dengan warranty rate tertinggi","Plan replacement untuk mesin dengan umur > 5 tahun","Negotiasi warranty extension untuk tipe mesin dengan coverage rendah"]},{id:"regional-efficiency",title:"Regional Efficiency Analysis",icon:N,color:"green",summary:`${c.length} regions analyzed`,metric:((y=c[0])==null?void 0:y.efficiency)||0,metricLabel:"Best Efficiency",chartType:"bar",data:c,description:"Analisis efisiensi regional berdasarkan ratio engineer:machine, average experience, dan total coverage.",analysis:[`Region paling efisien: ${((b=c[0])==null?void 0:b.region)||"N/A"} (efficiency ${(p=c[0])==null?void 0:p.efficiency}%)`,`Ratio engineer:machine terbaik: ${((j=c[0])==null?void 0:j.ratio)||0}`,`Total ${c.reduce((l,h)=>l+parseInt(h.engineers),0)} engineers handle ${c.reduce((l,h)=>l+parseInt(h.machines),0)} machines`],recommendations:["Redistribute engineer ke region dengan ratio tinggi (overload)","Hire additional engineers untuk region dengan efficiency < 50%","Share best practices dari region dengan efficiency tertinggi"]},{id:"distance-analysis",title:"Engineer-Machine Distance",icon:Z,color:"orange",summary:`${m.length} engineers analyzed`,metric:((w=m[0])==null?void 0:w.farZone)||0,metricLabel:"Most Far Zones",chartType:"bar",data:m,description:"Analisis jarak antara lokasi engineer dengan mesin yang ditangani berdasarkan zona. Semakin tinggi zona, semakin jauh jaraknya. Optimal assignment adalah mesin di zona yang sama atau berdekatan.",analysis:[`Engineer dengan jarak terjauh: ${((A=m[0])==null?void 0:A.engineer)||"N/A"} (${((D=m[0])==null?void 0:D.farZone)||0} mesin zona jauh)`,`Total ${m.reduce((l,h)=>l+h.farZone,0)} mesin ditangani engineer zona berbeda jauh`,`${m.filter(l=>l.farZone>0).length} engineer handle mesin di luar zona mereka`],recommendations:["Reassign mesin di zona jauh ke engineer lokal yang lebih dekat","Prioritas immediate: engineer dengan >3 mesin di zona berbeda","Consider hiring engineer baru di zona dengan banyak mesin tanpa coverage lokal"]},{id:"zone-optimization",title:"Zone Coverage Optimization",icon:N,color:"yellow",summary:`${o.length} zones mapped`,metric:((E=o[0])==null?void 0:E.needsAttention)||0,metricLabel:"Priority Machines",chartType:"bar",data:o,description:"Optimasi coverage engineer per zona berdasarkan jumlah mesin, engineer assigned, dan mesin yang butuh perhatian. Priority score dihitung dari rasio mesin critical per total mesin di zona.",analysis:[`Zona prioritas tertinggi: ${((M=o[0])==null?void 0:M.zone)||"N/A"} (${((T=o[0])==null?void 0:T.needsAttention)||0} mesin perlu attention)`,`Ratio engineer:machine tertinggi: ${o.length>0?Math.max(...o.map(l=>parseFloat(l.ratio)||0)).toFixed(1):0}`,`Total ${o.reduce((l,h)=>l+h.machines,0)} mesin across ${o.length} zones`],recommendations:["Deploy additional engineers ke zona dengan ratio >10 machines per engineer","Focus maintenance resources pada zona dengan high needsAttention count","Optimize travel routes untuk engineer yang cover multiple zones"]}]}function te({card:n,onClick:r}){const s=n.icon,c=()=>!n.data||n.data.length===0?null:e.jsx("div",{className:"h-24",children:e.jsx(z,{width:"100%",height:"100%",children:n.chartType==="radar"?e.jsxs(R,{data:n.data.slice(0,3),children:[e.jsx(_,{stroke:"#475569"}),e.jsx($,{dataKey:"performance",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.6})]}):e.jsx(K,{data:n.data.slice(0,4),children:e.jsx(x,{dataKey:n.id==="distance-analysis"?"farZone":n.id==="zone-optimization"?"machines":"total",fill:"#3b82f6"})})})});return e.jsxs("div",{onClick:r,className:k(O(n.color,!0),"cursor-pointer group"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(s,{className:k(`text-${n.color}-400`),size:24}),e.jsx("h3",{className:v.heading3,children:n.title})]}),e.jsx("p",{className:v.bodySmall,children:n.summary})]}),e.jsx(I,{className:k("text-slate-400 group-hover:text-slate-200 transition-colors"),size:20})]}),c(),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:v.bodySmall,children:n.metricLabel}),e.jsx("p",{className:k("text-3xl font-bold",`text-${n.color}-400`),children:n.metric})]}),e.jsx("div",{className:k(F[n.color]||F.blue,"text-xs font-medium"),children:"Click for details"})]})]})}function ie({card:n,onClose:r}){const{isDark:s}=q();if(!n)return null;const c=()=>{if(!n.data||n.data.length===0)return e.jsx("div",{className:s?"text-slate-400 text-center py-20":"text-gray-600 text-center py-20",children:"No data available"});switch(n.chartType){case"radar":return e.jsx(z,{width:"100%",height:400,children:e.jsxs(R,{data:n.data,children:[e.jsx(_,{stroke:"#475569"}),e.jsx(X,{dataKey:"name",stroke:"#94a3b8"}),e.jsx(H,{stroke:"#64748b"}),e.jsx($,{name:"Performance",dataKey:"performance",stroke:"#3b82f6",fill:"#3b82f6",fillOpacity:.6}),e.jsx($,{name:"Experience",dataKey:"experience",stroke:"#10b981",fill:"#10b981",fillOpacity:.4}),e.jsx(S,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155"}}),e.jsx(C,{})]})});case"bar":const o=n.id==="distance-analysis",d=n.id==="zone-optimization";return e.jsx(z,{width:"100%",height:400,children:e.jsxs(K,{data:n.data,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(B,{strokeDasharray:"3 3",stroke:"#334155"}),e.jsx(Y,{dataKey:o?"engineer":d?"zone":n.id==="regional-efficiency"?"region":"type",stroke:"#94a3b8",angle:-45,textAnchor:"end",height:80}),e.jsx(G,{stroke:"#94a3b8"}),e.jsx(S,{contentStyle:{backgroundColor:"#1e293b",border:"1px solid #334155"}}),e.jsx(C,{}),o?e.jsxs(e.Fragment,{children:[e.jsx(x,{dataKey:"sameZone",fill:"#10b981",name:"Same Zone"}),e.jsx(x,{dataKey:"nearZone",fill:"#f59e0b",name:"Near Zone"}),e.jsx(x,{dataKey:"farZone",fill:"#ef4444",name:"Far Zone"})]}):d?e.jsxs(e.Fragment,{children:[e.jsx(x,{dataKey:"machines",fill:"#3b82f6",name:"Total Machines"}),e.jsx(x,{dataKey:"engineers",fill:"#10b981",name:"Engineers"}),e.jsx(x,{dataKey:"needsAttention",fill:"#ef4444",name:"Needs Attention"})]}):n.id==="regional-efficiency"?e.jsxs(e.Fragment,{children:[e.jsx(x,{dataKey:"engineers",fill:"#3b82f6",name:"Engineers"}),e.jsx(x,{dataKey:"machines",fill:"#8b5cf6",name:"Machines"}),e.jsx(x,{dataKey:"efficiency",fill:"#10b981",name:"Efficiency %"})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{dataKey:"total",fill:"#3b82f6",name:"Total Units"}),e.jsx(x,{dataKey:"warrantyRate",fill:"#10b981",name:"Warranty %"})]})]})});default:return null}},m=n.icon;return e.jsx("div",{className:`fixed inset-0 ${s?"bg-black/80":"bg-black/60"} backdrop-blur-sm z-50 flex items-center justify-center p-4`,children:e.jsxs("div",{className:`${s?"bg-slate-900 border-slate-700":"bg-white border-gray-300"} rounded-2xl w-full max-w-7xl max-h-[90vh] overflow-y-auto border shadow-2xl`,children:[e.jsxs("div",{className:`sticky top-0 ${s?"bg-slate-900 border-slate-700":"bg-white border-gray-300"} border-b px-8 py-6 flex items-center justify-between z-10`,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{className:`text-${n.color}-${s?"400":"600"}`,size:32}),e.jsxs("div",{children:[e.jsx("h2",{className:`text-3xl font-bold ${s?"text-slate-100":"text-gray-900"}`,children:n.title}),e.jsx("p",{className:s?"text-slate-400 mt-1":"text-gray-600 mt-1",children:n.summary})]})]}),e.jsx("button",{onClick:r,className:`p-2 ${s?"hover:bg-slate-800 text-slate-400 hover:text-slate-200":"hover:bg-gray-100 text-gray-600 hover:text-gray-900"} rounded-lg transition-colors`,children:e.jsx(U,{size:24})})]}),e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{className:`${s?"bg-slate-800/50 border-slate-700":"bg-gray-50 border-gray-300"} rounded-xl p-6 border`,children:[e.jsxs("h3",{className:`text-lg font-semibold ${s?"text-slate-200":"text-gray-900"} mb-3 flex items-center gap-2`,children:[e.jsx(W,{size:20,className:s?"text-blue-400":"text-blue-600"}),"Deskripsi"]}),e.jsx("p",{className:s?"text-slate-300 leading-relaxed":"text-gray-700 leading-relaxed",children:n.description})]}),e.jsxs("div",{className:`${s?"bg-slate-800/50 border-slate-700":"bg-gray-50 border-gray-300"} rounded-xl p-6 border`,children:[e.jsx("h3",{className:`text-lg font-semibold ${s?"text-slate-200":"text-gray-900"} mb-6`,children:"Data Visualization"}),c()]}),e.jsxs("div",{className:`${s?"bg-slate-800/50 border-slate-700":"bg-gray-50 border-gray-300"} rounded-xl p-6 border`,children:[e.jsxs("h3",{className:`text-lg font-semibold ${s?"text-slate-200":"text-gray-900"} mb-4 flex items-center gap-2`,children:[e.jsx(N,{size:20,className:s?"text-green-400":"text-green-600"}),"Analisa Data"]}),e.jsx("ul",{className:"space-y-3",children:n.analysis.map((o,d)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:s?"text-green-400 mt-1":"text-green-600 mt-1",children:"â€¢"}),e.jsx("span",{className:s?"text-slate-300":"text-gray-700",children:o})]},d))})]}),e.jsxs("div",{className:O("blue",!1),children:[e.jsxs("h3",{className:`${s?"text-white":"text-gray-900"} text-lg font-semibold mb-4 flex items-center gap-2`,children:[e.jsx(Z,{size:20,className:s?"text-yellow-400":"text-yellow-600"}),"Rekomendasi & Action Items"]}),e.jsx("ul",{className:"space-y-3",children:n.recommendations.map((o,d)=>e.jsxs("li",{className:"flex items-start gap-3",children:[e.jsx("span",{className:`flex-shrink-0 w-6 h-6 rounded-full ${s?"bg-blue-500/20 text-blue-400":"bg-blue-100 text-blue-600"} flex items-center justify-center text-sm font-semibold`,children:d+1}),e.jsx("span",{className:s?"text-slate-300":"text-gray-700",children:o})]},d))})]})]})]})})}function de(){const{rows:n,loading:r}=Q(),{rows:s,loading:c}=V(),[m,o]=u.useState(null),d=r||c,i=ae(n,s),a=u.useMemo(()=>ne(i),[i]);return d?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(J,{type:"spinner",message:"Memuat analisis data...",size:"lg"})}):e.jsxs(ee,{title:"Decision Intelligence",subtitle:"Data comparison, analysis, and decision support",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:a.map(t=>e.jsx(te,{card:t,onClick:()=>o(t)},t.id))}),e.jsx(ie,{card:m,onClose:()=>o(null)})]})}export{de as default};
