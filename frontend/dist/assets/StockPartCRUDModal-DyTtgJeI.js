import{R as b,r as S,j as e,P,aw as A,X as G,H as B,ac as H,I as y,ae as J,b as z,ax as K,a5 as F,J as T}from"./vendor-react-DhTDDHjY.js";import{u as X,C as Y}from"./InlineLoadingSpinner-DhnWRttN.js";import"./index-BUgy-9su.js";import"./vendor-maps-C_U1R0uQ.js";function ae({isOpen:I,onClose:w,modalMode:r,formData:l,setFormData:c,stockParts:d,validParts:C,editingFSL:h,onPartNumberSelect:q,onSave:k}){if(!I)return null;const x=X(),[i,N]=b.useState("set"),[f,L]=b.useState(""),[_,E]=b.useState(""),[Q,W]=b.useState(!1),[Z,M]=b.useState(null),m=S.useMemo(()=>d.length>0?Object.keys(d[0]).filter(s=>s.toLowerCase().includes("idfsl")||s.toLowerCase().includes("idccw")).sort():[],[d]),p=S.useMemo(()=>{const s={};return!d||d.length===0||["type_of_part","20_top_usage"].forEach(a=>{const n=new Set;d.forEach(u=>{const o=u[a]||u[a.replace("_"," ")];o!=null&&o!==""&&n.add(String(o).trim())}),s[a]=Array.from(n).sort()}),s},[d]),R=["Initial Stock","Stock Replenishment","Physical Count Adjustment","Return from Service","Damaged/Lost","Transfer In","Transfer Out","Emergency Supply","Other"],O=s=>{if(r==="edit"&&d){const t=d.find(a=>a.part_number===l.part_number);return parseInt((t==null?void 0:t[s])||0)}return 0},U=()=>m.reduce((s,t)=>{const a=l[t];return s+(a===""||a===null||a===void 0?0:parseInt(a)||0)},0),V=s=>{let t=s;if(s.includes("idfsl")&&s.includes("_fsl_")){const a=s.split("_fsl_")[1];a&&(t="FSL "+a.split("_").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" "))}else if(s.includes("idccw")){const a=s.replace(/^idccw\d+_/,"");a&&(t=a.split("_").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" "),s.toLowerCase().includes("idccw00")&&(t+=" (Jakarta)"))}return t},$=m.filter(s=>h?s.toLowerCase().includes(h.toLowerCase().substring(0,5)):!0);return e.jsxs("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-slate-700 shadow-2xl w-full max-w-7xl max-h-[95vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-slate-800 to-slate-700 border-b border-slate-600 px-6 py-5 flex justify-between items-center shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center",children:r==="create"?e.jsx(P,{className:"text-blue-400",size:20}):e.jsx(A,{className:"text-blue-400",size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-100",children:r==="create"?"Tambah Part Baru":"Edit Part"}),e.jsx("p",{className:"text-xs text-slate-400 mt-0.5",children:r==="create"?"Isi form di bawah untuk menambahkan part baru":"Perbarui informasi part dan stock"})]})]}),e.jsx("button",{onClick:w,className:"text-slate-400 hover:text-slate-200 hover:bg-slate-700/50 p-2 rounded-lg transition-all",title:"Tutup",children:e.jsx(G,{size:20})})]}),e.jsxs("div",{className:"p-6 space-y-8 max-h-[calc(90vh-180px)] overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-slate-700/50",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center",children:e.jsx(P,{className:"text-blue-400",size:18})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-200",children:"Informasi Part"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-300",children:[e.jsx(B,{className:"text-blue-400",size:16}),e.jsxs("span",{children:["Part Number ",e.jsx("span",{className:"text-red-400 ml-1",children:"*"})]})]}),r==="create"?e.jsx("input",{type:"text",value:l.part_number,onChange:s=>{const t=s.target.value;c({...l,part_number:t});const a=C.find(n=>(n.part_number||n["part number"])===t);a&&c({...l,part_number:t,part_name:a.part_name||a["part name"]||"",type_of_part:a.type_of_part||a["type of part"]||"","20_top_usage":a["20_top_usage"]||a["20 top usage"]||"No"})},className:"w-full px-4 py-3 bg-slate-700/60 border border-slate-600 rounded-xl text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all hover:bg-slate-700/80 hover:border-slate-500",placeholder:"Masukkan Part Number baru"}):e.jsx("input",{type:"text",value:l.part_number,disabled:!0,className:"w-full px-4 py-3 bg-slate-700/30 border border-slate-600 rounded-xl text-slate-400 opacity-50 cursor-not-allowed"}),e.jsx("p",{className:"text-xs text-slate-500",children:r==="create"?"Masukkan Part Number baru (jika part sudah ada, gunakan Edit)":"Part Number tidak dapat diubah"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-300",children:[e.jsx(H,{className:"text-green-400",size:16}),e.jsxs("span",{children:["Part Name ",e.jsx("span",{className:"text-red-400 ml-1",children:"*"})]})]}),e.jsx("input",{type:"text",value:l.part_name,onChange:s=>c({...l,part_name:s.target.value}),disabled:r==="edit",className:`w-full px-4 py-3 border border-slate-600 rounded-xl transition-all ${r==="edit"?"bg-slate-700/30 text-slate-400 opacity-50 cursor-not-allowed":"bg-slate-700/60 text-slate-100 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 hover:bg-slate-700/80 hover:border-slate-500"}`,placeholder:r==="create"?"Masukkan Part Name":"Auto-filled dari Part Number"}),e.jsx("p",{className:"text-xs text-slate-500",children:r==="create"?"Masukkan nama part baru":"Otomatis terisi dari Part Number"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-300",children:[e.jsx(y,{className:"text-purple-400",size:16}),e.jsx("span",{children:"Type of Part"})]}),p.type_of_part&&p.type_of_part.length>0?e.jsxs("select",{value:l.type_of_part,onChange:s=>c({...l,type_of_part:s.target.value}),className:"w-full px-4 py-3 bg-slate-700/60 border border-slate-600 rounded-xl text-slate-100 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500 transition-all hover:bg-slate-700/80 hover:border-slate-500",children:[e.jsx("option",{value:"",className:"bg-slate-800",children:"-- Pilih Type of Part --"}),p.type_of_part.map((s,t)=>e.jsx("option",{value:s,className:"bg-slate-800",children:s},t))]}):e.jsx("input",{type:"text",value:l.type_of_part,disabled:!0,className:"w-full px-4 py-3 bg-slate-700/30 border border-slate-600 rounded-xl text-slate-400 opacity-50 cursor-not-allowed",placeholder:"Auto-filled dari Part Number"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Jenis part (pilih dari daftar atau otomatis terisi)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-300",children:[e.jsx(J,{className:"text-yellow-400",size:16}),e.jsx("span",{children:"Top 20 Usage"})]}),p["20_top_usage"]&&p["20_top_usage"].length>0?e.jsxs("select",{value:l["20_top_usage"],onChange:s=>c({...l,"20_top_usage":s.target.value}),className:"w-full px-4 py-3 bg-slate-700/60 border border-slate-600 rounded-xl text-slate-100 focus:outline-none focus:ring-2 focus:ring-yellow-500/50 focus:border-yellow-500 transition-all hover:bg-slate-700/80 hover:border-slate-500",children:[e.jsx("option",{value:"",className:"bg-slate-800",children:"-- Pilih Top 20 Usage --"}),p["20_top_usage"].map((s,t)=>e.jsx("option",{value:s,className:"bg-slate-800",children:s},t))]}):e.jsx("input",{type:"text",value:l["20_top_usage"],disabled:!0,className:"w-full px-4 py-3 bg-slate-700/30 border border-slate-600 rounded-xl text-slate-400 opacity-50 cursor-not-allowed",placeholder:"Auto-filled dari Part Number"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Status penggunaan part (Yes/No - pilih dari daftar)"})]})]})]}),r==="edit"&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-slate-700/50",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center",children:e.jsx(z,{className:"text-cyan-400",size:18})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-200",children:"Stock Adjustment Mode"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{N("set");const s=d.find(t=>(t.part_number||t["part number"])===l.part_number);if(s){const t={...l};m.forEach(a=>{t[a]=parseInt(s[a]||0)}),c(t)}},className:`p-4 rounded-xl border-2 transition-all ${i==="set"?"border-blue-500 bg-blue-500/20 text-blue-300 shadow-lg":"border-slate-600 bg-slate-800/50 text-slate-400 hover:border-slate-500"}`,children:[e.jsx(A,{size:20,className:"mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-semibold",children:"Set Stock"}),e.jsx("div",{className:"text-xs opacity-75 mt-1",children:"Ganti langsung"})]}),e.jsxs("button",{type:"button",onClick:()=>{N("add");const s={...l};m.forEach(t=>{s[t]=0}),c(s)},className:`p-4 rounded-xl border-2 transition-all ${i==="add"?"border-green-500 bg-green-500/20 text-green-300 shadow-lg":"border-slate-600 bg-slate-800/50 text-slate-400 hover:border-slate-500"}`,children:[e.jsx(z,{size:20,className:"mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-semibold",children:"Stock IN"}),e.jsx("div",{className:"text-xs opacity-75 mt-1",children:"Tambah stock"})]}),e.jsxs("button",{type:"button",onClick:()=>{N("remove");const s={...l};m.forEach(t=>{s[t]=0}),c(s)},className:`p-4 rounded-xl border-2 transition-all ${i==="remove"?"border-red-500 bg-red-500/20 text-red-300 shadow-lg":"border-slate-600 bg-slate-800/50 text-slate-400 hover:border-slate-500"}`,children:[e.jsx(K,{size:20,className:"mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-semibold",children:"Stock OUT"}),e.jsx("div",{className:"text-xs opacity-75 mt-1",children:"Kurangi stock"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-300",children:[e.jsx(F,{className:"text-yellow-400",size:16}),e.jsxs("span",{children:["Reason ",e.jsx("span",{className:"text-red-400 ml-1",children:"*"})]})]}),e.jsxs("select",{value:f,onChange:s=>L(s.target.value),className:"w-full px-4 py-3 bg-slate-700/60 border border-slate-600 rounded-xl text-slate-100 focus:outline-none focus:ring-2 focus:ring-yellow-500/50 focus:border-yellow-500 transition-all hover:bg-slate-700/80 hover:border-slate-500",children:[e.jsx("option",{value:"",className:"bg-slate-800",children:"-- Pilih Reason --"}),R.map((s,t)=>e.jsx("option",{value:s,className:"bg-slate-800",children:s},t))]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Alasan perubahan stock (wajib diisi)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-300",children:[e.jsx(y,{className:"text-purple-400",size:16}),e.jsx("span",{children:"Notes"})]}),e.jsx("textarea",{value:_,onChange:s=>E(s.target.value),rows:3,className:"w-full px-4 py-3 bg-slate-700/60 border border-slate-600 rounded-xl text-slate-100 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500 transition-all resize-none hover:bg-slate-700/80 hover:border-slate-500",placeholder:"Catatan tambahan (opsional)..."}),e.jsx("p",{className:"text-xs text-slate-500",children:"Informasi detail perubahan"})]})]})]}),e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between pb-3 border-b border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-orange-500/20 flex items-center justify-center",children:e.jsx(T,{className:"text-orange-400",size:18})}),e.jsx("h3",{className:"text-lg font-semibold text-slate-200",children:h?`Stock di ${h}`:"Stock per FSL Location"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-cyan-500/20 px-4 py-2 rounded-lg border border-cyan-500/30",children:[e.jsx("span",{className:"text-slate-300",children:"Grand Total:"}),e.jsx("span",{className:"text-cyan-400 font-bold text-lg",children:U()}),e.jsx("span",{className:"text-slate-400",children:"units"})]})]}),e.jsxs("div",{className:"bg-slate-800/30 rounded-lg p-4 border border-slate-700/50",children:[e.jsxs("p",{className:"text-xs text-slate-400 mb-3 flex items-center gap-1",children:[e.jsx(y,{size:14}),r==="edit"&&i==="set"&&"Masukkan jumlah stock akhir untuk setiap FSL location.",r==="edit"&&i==="add"&&"Masukkan jumlah stock yang ingin DITAMBAHKAN untuk setiap FSL location.",r==="edit"&&i==="remove"&&"Masukkan jumlah stock yang ingin DIKURANGI untuk setiap FSL location.",r==="create"&&"Masukkan jumlah stock untuk setiap FSL location. Nilai akan otomatis dijumlahkan sebagai Grand Total."]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 max-h-96 overflow-y-auto p-2",children:$.map(s=>{const t=V(s),a=l[s],n=a===""||a===null||a===void 0?0:parseInt(a)||0,u=O(s);let o=n;return r==="edit"&&i==="add"?o=u+n:r==="edit"&&i==="remove"?o=Math.max(0,u-n):r==="edit"&&i==="set"&&(o=n),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("label",{className:"flex items-center gap-1.5 text-xs font-medium text-slate-300",children:[e.jsx(T,{size:12,className:"text-orange-400"}),e.jsx("span",{className:"truncate",title:t,children:t})]}),r==="edit"&&e.jsxs("div",{className:"text-xs text-slate-500 mb-1",children:["Stock saat ini: ",e.jsx("span",{className:"text-blue-400 font-semibold",children:u})]}),e.jsx("input",{type:"number",min:"0",step:"1",value:l[s]===void 0||l[s]===null||l[s]===""?"":l[s],onChange:g=>{const j=g.target.value;if(j==="")c({...l,[s]:""});else{const v=parseInt(j);!isNaN(v)&&v>=0&&c({...l,[s]:v})}},onBlur:g=>{const j=g.target.value===""?0:parseInt(g.target.value)||0;c({...l,[s]:j})},className:"w-full px-3 py-2.5 bg-slate-700/60 border border-slate-600 rounded-xl text-slate-100 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500 text-sm transition-all hover:bg-slate-700/80 hover:border-slate-500",placeholder:"0"}),r==="edit"&&i!=="set"&&n>0&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-slate-400",children:"Akan menjadi: "}),e.jsx("span",{className:`font-semibold ${o<u?"text-red-400":o>u?"text-green-400":"text-slate-300"}`,children:o})]}),r==="create"&&n>0&&e.jsxs("p",{className:"text-xs text-green-400 font-medium",children:[n," unit"]}),r==="edit"&&i==="set"&&n>0&&e.jsxs("p",{className:"text-xs text-green-400 font-medium",children:[n," unit"]})]},s)})})]})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-gradient-to-r from-slate-800 to-slate-700 border-t border-slate-600 px-6 py-5 flex justify-end gap-3 shadow-lg",children:[e.jsx("button",{onClick:w,className:"px-6 py-3 bg-slate-700/80 hover:bg-slate-600 text-slate-100 rounded-xl transition-all font-medium shadow-lg hover:shadow-xl hover:scale-105",children:"Batal"}),e.jsx("button",{onClick:()=>{if(r==="create"){k(l);return}if(!f){x.warning("Alasan perubahan stock wajib diisi!");return}k({formData:l,reason:f,notes:_,mode:i})},className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white rounded-xl transition-all font-medium shadow-lg hover:shadow-xl hover:scale-105 flex items-center gap-2",children:r==="create"?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"+"})," Tambah Part"]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"âœ“"})," Update Stock"]})})]})]}),e.jsx(Y,{isOpen:x.alertState.isOpen,onClose:x.closeAlert,type:x.alertState.type,title:x.alertState.title,message:x.alertState.message,duration:x.alertState.duration})]})}export{ae as default};
